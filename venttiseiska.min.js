/*!
 * @license
 * Venttiseiska v0.1.0
 * https://github.com/niklasramo/venttiseiska
 * Copyright (c) 2016 Niklas Rämö <inramo@gmail.com>
 * Released under the MIT license
 */
!function(t,e){"function"==typeof define&&define.amd?define([],function(){return e(t)}):"object"==typeof module&&module.exports?module.exports=e(t):t.Venttiseiska=e(t)}(this,function(t,e){"use strict";function n(){v?_.set(this,{}):this._listeners={}}function r(t){var e=[],n=0;t="string"==typeof t?t.split(l):t;for(var r=0,i=t.length;i>r;r++){var o=t[r].split(u),s=o.shift();s&&(e[n++]=[s,o])}return e}function i(t){return"object"==typeof t&&null!==t&&"[object Object]"===Object.prototype.toString.call(t)}function o(t,e){for(var n=0,r=t.length;r>n;n++)if(e.indexOf(t[n])<0)return!1;return!0}function s(t){var e=[],n=g?new g:Object.create(null),r=t.length;if(g)for(;r--;)n.has(t[r])||(n.add(t[r]),e.push(t[r]));else for(;r--;){var i=t[r],o=v?_.get(i)._id:i._id;n[o]||(n[o]=1,e.push(i))}return e}function c(t,e){var n=v?_.get(t)._id:t._id,r=v?_.get(e)._id:e._id;return r>n?-1:n>r?1:0}function f(e){var n=t.Symbol;return e&&"function"==typeof n&&"function"==typeof n.toString&&n(e).toString().indexOf("[native code]")>-1&&e}var a=0,l=" ",u=":",h=n.prototype,g=f(t.WeakSet),v=f(t.WeakMap),_=v?new v:null;return h.on=function(t,e,o){var s,c=this,f=[];i(t)&&(s=t.cycles,o=t.context,e=t.listener,t=t.events),t=r(t);for(var a=0,l=t.length;l>a;a++)f.push(new n.Listener(c,t[a][0],e,t[a][1],o,s));return f},h.once=function(t,e,n){var r=i(t)?t:{events:t,listener:e,context:n};return r.cycles=1,this.on(r)},h.off=function(t,e){var n=v?_.get(this):this._listeners;if(t){var i="number"==typeof e,s="function"==typeof e;t=r(t);for(var c=0,f=t.length;f>c;c++){var a=t[c][0],l=t[c][1],u=n[a],h=l.length,g=u?u.length:0;if(g)if(e||h)for(;g--;){var p=v?_.get(u[g]):u[g];h&&!o(l,p._tags)||!(!e||s&&e===p._fn||i&&e===p._id)||(p._bound=!1,u.splice(g,1))}else{for(;g--;)(v?_.get(u[g]):u[g])._bound=!1;u.length=0}}}else for(var c=0,d=Object.keys(n),f=d.length;f>c;c++){for(var u=n[d[c]],g=u?u.length:0;g--;)(v?_.get(u[g]):u[g])._bound=!1;u.length=0}},h.emit=function(t,e,n){var i=v?_.get(this):this._listeners,s=arguments.length>2;t=r(t);for(var c=0,f=t.length;f>c;c++){var a=t[c][0],l=t[c][1],u=i[a],h=u&&u.length,g=l.length;if(h)for(var p=0;h>p;p++){var d=u[p];(!g||o(l,(v?_.get(d):d)._tags))&&(s?d.emit(e,n):d.emit(e))}}},h.getEvents=function(){for(var t=v?_.get(this):this._listeners,e=[],n=0,r=Object.keys(t),i=r.length;i>n;n++)t[r[n]]&&t[r[n]].length>0&&e.push(r[n]);return e},h.getListeners=function(t){var e=v?_.get(this):this._listeners,n=[],i=0;t=r(t||this.getEvents());for(var f=0,a=t.length;a>f;f++){++i;var l=t[f][0],u=t[f][1],h=e[l],g=h.length;if(g)if(u.length)for(var p=0;g>p;p++){var d=h[p],y=v?_.get(d):d;o(u,y._tags)&&n.push(d)}else n=n.concat(e[l])}return i>1&&n.length>1?s(n).sort(c):n},n.Listener=function(t,e,r,i,o,s){t instanceof n||(e=t.event,r=t.fn,i=t.tags,o=t.context,s=t.cycles,t=t.emitter);var c={_id:++a,_emitter:t,_event:e,_fn:r,_tags:(i||[]).concat(),_context:o,_cycles:s||0,_active:!0,_bound:!0};if(v)_.set(this,c);else for(var f=0,l=Object.keys(c),u=l.length;u>f;f++)this[l[f]]=c[l[f]];var h=v?_.get(t):t._listeners;(h[e]=h[e]||[]).push(this)},n.Listener.prototype.off=function(){var t=v?_.get(this):this;return t._bound&&t._emitter.off(t._event,t._id),this},n.Listener.prototype.emit=function(t,e){var n=v?_.get(this):this;if(n._bound&&n._active){var r=n._fn,i=arguments.length>1?e:n._context,o=t?t.length:0;o?1===o?r.call(i,t[0]):2===o?r.call(i,t[0],t[1]):3===o?r.call(i,t[0],t[1],t[2]):4===o?r.call(i,t[0],t[1],t[2],t[3]):5===o?r.call(i,t[0],t[1],t[2],t[3],t[4]):r.apply(i,t.concat()):r.call(i),n._cycles&&0===--n._cycles&&this.off()}return this},n.Listener.prototype.update=function(t){if(t&&i(t)){var e=v?_.get(this):this;if(e._bound)for(var n=["fn","tags","context","cycles","active"],r=0;5>r;r++){var o=n[r];t.hasOwnProperty(o)&&t[o]!==e["_"+o]&&(e["_"+o]=t[o])}}return this},n.Listener.prototype.inspect=function(){var t=v?_.get(this):this;return{id:t._id,emitter:t._emitter,event:t._event,fn:t._fn,tags:t._tags.concat(),context:t._context,cycles:t._cycles,active:t._active,bound:t._bound}},n});