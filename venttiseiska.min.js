/*!
 * @license
 * Venttiseiska v0.1.0-beta
 * https://github.com/niklasramo/venttiseiska
 * Copyright (c) 2016 Niklas Rämö <inramo@gmail.com>
 * Released under the MIT license
 */
!function(t,e){var n="Venttiseiska";"function"==typeof define&&define.amd?define(n,[],function(){return e(t)}):"object"==typeof module&&module.exports?module.exports=e(t):t[n]=e(t)}("object"==typeof window&&window.window||this,function(t,e){"use strict";function n(){v?p.set(this,{}):this._listeners={}}function i(t){return"string"==typeof t?t.split(h):t}function r(t,e){t=i(t);for(var n=0,r=t.length;r>n;n++){var o=t[n].split(l),s=o.shift();s&&e(s,o)}}function o(t){return"object"==typeof t&&null!==t&&"[object Object]"===Object.prototype.toString.call(t)}function s(t,e){for(var n=0,i=t.length;i>n;n++)if(e.indexOf(t[n])<0)return!1;return!0}function c(t){var e=[],n=_?new _:Object.create(null),i=t.length;if(_)for(;i--;)n.has(t[i])||(n.add(t[i]),e.push(t[i]));else for(;i--;){var r=t[i],o=v?p.get(r)._id:r._id;n[o]||(n[o]=1,e.push(r))}return e}function f(t,e){var n=v?p.get(t)._id:t._id,i=v?p.get(e)._id:e._id;return i>n?-1:n>i?1:0}function u(e){var n=t.Symbol;return e&&"function"==typeof n&&"function"==typeof n.toString&&n(e).toString().indexOf("[native code]")>-1&&e}var a=0,h=" ",l=":",g=n.prototype,_=u(t.WeakSet),v=u(t.WeakMap),p=v?new v:null;return g.on=function(t,e,i){var s,c=this,f=[];return o(t)&&(s=t.cycles,i=t.context,e=t.listener,t=t.events),r(t,function(t,r){f.push(new n.Listener(c,t,e,r,i,s))}),f},g.once=function(t,e,n){var i=o(t)?t:{events:t,listener:e,context:n};return i.cycles=1,this.on(i)},g.off=function(t,e){var n=v?p.get(this):this._listeners;if(t){var i="number"==typeof e,o="function"==typeof e;r(t,function(t,r){var c=n[t],f=r.length,u=c?c.length:0;if(u)if(e||f)for(;u--;){var a=v?p.get(c[u]):c[u];f&&!s(r,a._tags)||!(!e||o&&e===a._fn||i&&e===a._id)||(a._bound=!1,c.splice(u,1))}else{for(;u--;)(v?p.get(c[u]):c[u])._bound=!1;c.length=0}})}else for(var c=0,f=Object.keys(n),u=f.length;u>c;c++){for(var a=n[f[c]],h=a?a.length:0;h--;)(v?p.get(a[h]):a[h])._bound=!1;a.length=0}},g.emit=function(t,e,n){var i=v?p.get(this):this._listeners,o=arguments.length>1;r(t,function(t,r){var c=i[t],f=c&&c.length,u=r.length;if(f)for(var a=0;f>a;a++){var h=c[a],l=v?p.get(h):h;(!u||s(r,l._tags))&&(o?h.emit(e,n):h.emit(e))}})},g.getEvents=function(){for(var t=v?p.get(this):this._listeners,e=[],n=0,i=Object.keys(t),r=i.length;r>n;n++)t[i[n]]&&t[i[n]].length>0&&e.push(i[n]);return e},g.getListeners=function(t){var e=v?p.get(this):this._listeners,n=[],i=0;return t=t||this.getEvents(),r(t,function(t,r){++i;var o=e[t],c=o.length;if(c)if(r.length)for(var f=0;c>f;f++){var u=o[f],a=v?p.get(u):u;s(r,a._tags)&&n.push(u)}else n=n.concat(e[t])}),i>1&&n.length>1?c(n).sort(f):n},n.Listener=function(t,e,i,r,o,s){t instanceof n||(e=t.event,i=t.fn,r=t.tags,o=t.context,s=t.cycles,t=t.emitter);var c={_id:++a,_emitter:t,_event:e,_fn:i,_tags:(r||[]).concat(),_context:o,_cycles:s||0,_active:!0,_bound:!0};if(v)p.set(this,c);else for(var f=0,u=Object.keys(c),h=u.length;h>f;f++)this[u[f]]=c[u[f]];var l=v?p.get(t):t._listeners;(l[e]=l[e]||[]).push(this)},n.Listener.prototype.off=function(){var t=v?p.get(this):this;return t._bound&&t._emitter.off(t._event,t._id),this},n.Listener.prototype.emit=function(t,e){var n=v?p.get(this):this;return n._bound&&n._active&&(n._fn.apply(arguments.length>1?e:n._context,Array.isArray(t)?t.concat():[]),n._cycles&&0===--n._cycles&&this.off()),this},n.Listener.prototype.update=function(t){if(t&&o(t)){var e=v?p.get(this):this;if(e._bound)for(var n=["fn","tags","context","cycles","active"],i=0;5>i;i++){var r=n[i];t.hasOwnProperty(r)&&t[r]!==e["_"+r]&&(e["_"+r]=t[r])}}return this},n.Listener.prototype.inspect=function(){var t=v?p.get(this):this;return{id:t._id,emitter:t._emitter,event:t._event,fn:t._fn,tags:t._tags.concat(),context:t._context,cycles:t._cycles,active:t._active,bound:t._bound}},n});